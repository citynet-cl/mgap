// Create the dc.js chart objects & link to div
var timeChart = dc.lineChart("#g1");
var dataTable = dc.dataTable("#t1");

// load data from a csv file
d3.json("http://localhost:3000/tareas.json", function (data) {
//
//var data = [
//    {fecha_registro:"1-May-12",hh:"58"},
//    {fecha_registro:"30-Apr-12",hh:"53"},
//    {fecha_registro:"27-Apr-12",hh:"67"},
//    {fecha_registro:"26-Apr-12",hh:"89"},
//    {fecha_registro:"25-Apr-12",hh:"99"}
//];

        var dateFormat = d3.time.format("%Y-%m-%d");

  // format our data

        data.forEach(function (d) {
            d.fr = dateFormat.parse(d.fecha_registro);
	    d.mes = d3.time.month(d.fr);
	    d.h   = +d.hh;
});

  // Run the data through crossfilter and load our 'facts'
  var facts = crossfilter(data);

  // Create dataTable dimension
  var timeByDay = facts.dimension(function (d) {
    //return d3.time.month(d.fr);
    return d.mes;
  });

  var timeByDayGroup = timeByDay.group()
    ///.reduceCount(function(d) {return d.fr;});
    .reduceCount(function(d) {return d.fr;});

  // Setup the charts
  timeChart.width(960)
    .height(150)
    .margins({top: 10, right: 10, botton: 20, left: 40})
    .dimension(timeByDay)
    .group(timeByDayGroup)
    .transitionDuration(500)
    .elasticY(true)
    .x(d3.time.scale().domain([new Date(2013, 12, 01), new Date(2013, 12, 31)]))
    .xAxis();
  
  // Table of earthquake data
  dataTable.width(960).height(800)
    .dimension(timeByDay)
	.group(function(d) { return "tabla tareas"
	 })
	.size(10)
    .columns([
      function(d) { return d.fr; },
      function(d) { return d.h; },
    ])
    .sortBy(function(d){ return d.fr; })
    .order(d3.ascending);

  // Render the Charts
  dc.renderAll();
  
});
