<h1>Listado de tareas</h1>

<%= content_tag :h3, "Todas las Tareas" %>

<%= form_tag reportes_path, method: 'get' do %>
	<p>
		<%= text_field_tag :search, params[:search] %>
		<%= submit_tag "Buscar", name: nil %>
	</p>
<% end %>
	<p>
	  Download:
	  <%= link_to "Excel", reportes_path(format: "xls") %> 
	</p>

<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
            <th><%= ordenable "user_id", "Desarrollador" %></th>
            <th><%= ordenable "proyecto_id", "Proyecto" %></th>
            <th><%= ordenable "modulo_id", "Modulo" %></th>
            <th><%= ordenable "otro_id", "Otros" %></th>
            <th><%= ordenable "hh", "HH" %></th>
            <th><%= ordenable "fecha_registro", "Fecha Registro" %></th>
	    <th>Acciones</th>
	    <th></th>
      </tr>
    </thead>

    <tbody>
      <%= content_tag_for(:tr, @tareas_listado) do |tarea| %>
            <td><%= tarea.user.email %></td>
	      <% if tarea.proyecto.blank? and tarea.otro.blank? %>
		      <td></td>
		      <td><%= tarea.modulo.nombre.humanize %></td>
		      <td></td>
	      <% elsif tarea.proyecto.blank? and tarea.modulo.blank? %>
			      <td></td>
		      	      <td></td>
			      <td><%= tarea.otro.nombre.humanize %></td>
	      <% else %>
		      <td><%= tarea.proyecto.nombre.humanize %></td>
	              <td></td>
	              <td></td>
	      <% end  %>
            <td><%= tarea.hh %></td>
            <td><%= tarea.fecha_registro %></td>
	    <td><%= detalles_link tarea %></td>
      <% end %>
    </tbody>
  </table>
</div>

<%= content_tag :h2, "Tareas segun Mes" %>


<% @tareas_mes.keys.sort.each do |mes| %>
	<h3><%= mes.strftime("%B %Y") %></h3>
	<%  for tareas in @tareas_mes[mes] %>
		<p><%= tareas.nombre %> registrada en <%= tareas.fecha_registro %></p>
	<% end  %>
<% end  %>

<%= content_tag :h2, "Tareas segun Desarrollador" %>


<% @tareas_d.keys.sort.each do |desarrollador| %>
	<h2><%= desarrollador %></h2>
	<%  for tareas in @tareas_d[desarrollador] %>
		<p><%= tareas.nombre %> registrada en <%= tareas.fecha_registro %></p>
	<% end  %>
<% end  %>


<%= content_tag :h2, "Tareas segun Proyecto" %>

<% @tareas_p.each do |proyecto, tareas| %>
	<h2><%= proyecto %></h2>
	<%  tareas.each do |tarea| %>
		<p><%= tarea.nombre %> registrada en <%= tarea.fecha_registro %></p>
	<% end  %>
<% end  %>

<%= content_tag :h2, "Tareas segun Modulo" %>

<% @tareas_m.each do |modulo, tareas| %>
	<h2><%= modulo %></h2>
		<%  tareas.each do |tarea| %>
			<p><%= tarea.nombre %> registrada en <%= tarea.fecha_registro %></p>
		<% end %>
<% end  %>

<%= content_tag :h2, "Tareas segun Otros" %>

<% @tareas_o.each do |otro, tareas| %>
	<h2><%= otro %></h2>
		<%  tareas.each do |tarea| %>
			<p><%= tarea.nombre %> registrada en <%= tarea.fecha_registro %></p>
		<% end %>
<% end  %>
